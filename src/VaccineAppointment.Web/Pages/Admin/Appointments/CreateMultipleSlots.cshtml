@page
@model VaccineAppointment.Web.Pages.Admin.Appointments.CreateMultipleSlotsModel
@{
    ViewData["Title"] = "予約管理";
    var month = Model.Month;
    var prevMonth = Model.PrevMonth;
    var nextMonth = Model.NextMonth;

    var selectedDate = Model.SelectedDate;
    var prevDate = selectedDate.PlusDays(-1);
    var nextDate = selectedDate.PlusDays(1);
}

<h1>予約管理</h1>

<div class="row">
    <div class="col-lg-4">
        <div>
            <a class="btn btn-link pl-0" asp-page="CreateMultipleSlots" asp-route-year="@prevMonth.Year" asp-route-month="@prevMonth.Month" asp-route-day="@prevMonth.OnDayOfMonth(1).Day">前の月</a>
            <a class="btn btn-link pl-0" asp-page="CreateMultipleSlots" asp-route-year="@nextMonth.Year" asp-route-month="@nextMonth.Month" asp-route-day="@nextMonth.OnDayOfMonth(1).Day">次の月</a>
        </div>
        <h2>@Model.Month.Year 年 @Model.Month.Month 月</h2>
        <partial name="_Calendar" model="@(new CalendarViewModel() { Month = month, SelectedDate = Model.SelectedDate, LinkPage="CreateSlot" })" />
    </div>
    <div class="col-lg-8">
        <div class="d-flex justify-content-between">
            <div>
                <a class="btn btn-link pl-0" asp-page="CreateMultipleSlots" asp-route-year="@prevDate.Year" asp-route-month="@prevDate.Month" asp-route-day="@prevDate.Day">前の日</a>
                <a class="btn btn-link pl-0" asp-page="CreateMultipleSlots" asp-route-year="@nextDate.Year" asp-route-month="@nextDate.Month" asp-route-day="@nextDate.Day">次の日</a>
            </div>
            <div>
                <a class="btn btn-sm btn-outline-secondary" asp-page="CreateSlot" asp-route-year="@selectedDate.Year" asp-route-month="@selectedDate.Month" asp-route-day="@selectedDate.Day">戻る</a>
            </div>
        </div>
        <div class="d-flex justify-content-between">
            <h2>@Model.SelectedDate.Day 日 (@Model.SelectedDate.DayOfWeek)</h2>
        </div>
        <h3>新規予約枠の作成</h3>
        <form method="post">
            <div class="form-group">
                @{
                    var startDayOfWeek = NodaTime.IsoDayOfWeek.Monday;
                    var firstDayOfCalendar = month.OnDayOfMonth(1).DayOfWeek == startDayOfWeek ? month.OnDayOfMonth(1) : month.OnDayOfMonth(1).Previous(startDayOfWeek);
                }
                <table style="table-layout: fixed" class="table table-bordered w-100">
                    <colgroup>
                        <col />
                        <col />
                        <col />
                        <col />
                        <col />
                        <col />
                        <col />
                    </colgroup>
                    <thead>
                        <tr>
                            @for (var i = 0; i < 7; i++)
                            {
                                <th class="text-center">
                                    @switch (((int)startDayOfWeek + i) % 7)
                                    {
                                        case 0:
                                            <text>日</text>
                                            break;
                                        case 1:
                                            <text>月</text>
                                            break;
                                        case 2:
                                            <text>火</text>
                                            break;
                                        case 3:
                                            <text>水</text>
                                            break;
                                        case 4:
                                            <text>木</text>
                                            break;
                                        case 5:
                                            <text>金</text>
                                            break;
                                        case 6:
                                            <text>土</text>
                                            break;
                                    }

                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @for (var line = 0; line < 6; line++)
                        {
                            <tr>
                                @for (var dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++)
                                {
                                    var date = firstDayOfCalendar.PlusDays(line * 7 + dayOfWeek);
                                    @if (date.ToYearMonth() == month)
                                    {
                                        var value = NodaTime.Text.LocalDatePattern.CreateWithInvariantCulture("yyyy-MM-dd").Format(date);
                                        <td class="text-left">
                                            <label>
                                                <input class="form-check-inline" type="checkbox" name="SelectedDates" value="@value" @(Model.SelectedDates.Contains(value) ? "checked" : "") />@date.Day
                                            </label>
                                        </td>
                                    }
                                    else
                                    {
                                        <td class="text-left text-muted">
                                            @date.Day
                                        </td>
                                    }
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="form-group">
                <label>開始時刻</label>
                <input class="form-control" type="time" asp-for="StartTime" />
            </div>
            <div class="form-group">
                <label>1予約枠あたりの長さ (分)</label>
                <input class="form-control" type="number" asp-for="DurationMinutesForEachSlot" />
            </div>
            <div class="form-group">
                <label>1予約枠あたりの受入可能件数</label>
                <input class="form-control" type="number" asp-for="CountOfSlotForEachSlot" />
            </div>
            <div class="form-group">
                <label>作成する予約枠の件数</label>
                <input class="form-control" type="number" asp-for="CountOfSlotsToCreate" />
            </div>
            <div class="form-group">
                <button class="btn btn-primary">登録</button>
            </div>
        </form>
    </div>
</div>


